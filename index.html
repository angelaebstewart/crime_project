<!DOCTYPE html>
<meta charset="utf-8">
<style>

.counties {
  fill: none;
  stroke: #aaa;
}

.states {
  fill: none;
  stroke: #000;
  stroke-linejoin: round;
}

</style>
<div id="map">
<h4>Search for a specific county:</h4>
<div id="map_search" width="960" style="border: solid; border-width: thin; width: 500px;"></div>
<svg id="svg" width="960" height="600"></svg>
</div>
<br/><br/>
<div id="updatableChart"></div>
<br/><br/>
<svg id="svg2" width="960" height="600"></svg>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
<script src="https://d3js.org/topojson.v2.min.js"></script>
<script src="http://lorenzoongithub.github.io/completely/complete.ly.1.0.1.min.js"></script>
<script src="choropleth.js"></script>
<script src="barChart.js"></script>
<script src="getters.js"></script>
<style>
	div {
		padding: 20px 0 0 10px;
	}
</style>
<script>

        var countyData = [];
        var updatableChart;
        createRadioButtons();
        d3.json("countyData.json", function(error, data) {
            if(error) {
                console.log(error);
            }
            
            countyData = data;
            updatableChart = barChart().width(800).height(450).data(getRaceData(countyData, "16079")); //change width and height here
            d3.select('#updatableChart')
                .call(updatableChart);
        });
        function createRadioButtons() {
            var crimeTypes = ["Population", "Overall Crime", "Violent Crime", "Property Crime", 
                "Burglary", "Larceny-Theft", "Motor Vehicle Theft", 
                "Murder & Nonnegligent Manslaughter", "Rape", 
                "Robbery", "Aggravated Assault"];
            var selected = 0;
            var form = d3.select("body").append("form");
            var labels = form.selectAll("span")
                .data(crimeTypes)
                .enter()
                .append("span");
            labels.append("input")
                .attr('type', 'radio')
                .attr('class', 'crime-toggles')
                .attr('name', 'crime')
                .attr('value', function(d, i) {return d;})
                .property("checked", function(d, i) {return i===selected;})
                .on('click', function () { radioOnClick(this.value);});
            labels.append("label").html(function(d) {return d + "<br/>";});
        }
        //Nate, add code for updating your chart here.
        function radioOnClick(toggle_val) {
            updatableChart.data(getCountiesMedianIncome(countyData, "AL")); //this is just in here as dummy data to show how to update the bar chart
	    update_map(toggle_val);
        }

//SCATTERPLOT
var margin = {
		top: 20,
		right: 20,
		bottom: 30,
		left: 40
	},
	width = 960 - margin.left - margin.right,
	height = 500 - margin.top - margin.bottom;

var x = d3.scaleLinear()
	.range([0, width]);

var y = d3.scaleLinear()
	.range([height, 0]);

var xAxis = d3.axisBottom()
	.scale(x)
	.ticks(0);

var yAxis = d3.axisLeft()
	.scale(y)
	.ticks(0);


var svg2 = d3.select("#svg2")
	.attr("width", width + margin.left + margin.right)
	.attr("height", height + margin.top + margin.bottom)
	.append("g")
	.attr("transform", "translate(" + margin.left + "," + margin.top + ")");


svg2.append("text")
	.attr("x", (width / 2))             
	.attr("y", 0 - (margin.top / 1000))
	.attr("text-anchor", "middle")  
	.style("font", "26px sans-serif")  
	.text("NAME THIS GRAPH HERE");

var data = create_data(1000);

data.forEach(function(d) {
	d.x = +d.x;
	d.y = +d.y;
	d.yhat = +d.yhat;
});

var line = d3.line()
	.x(function(d) {
		return x(d.x);
	})
	.y(function(d) {
		return y(d.yhat);
	});

x.domain(d3.extent(data, function(d) {
	return d.x;
}));
y.domain(d3.extent(data, function(d) {
	return d.y;
}));

svg2.append("g")
	.attr("class", "x axis")
	.attr("transform", "translate(0," + height + ")")
	.call(xAxis)
	.append("text")
	.attr("class", "label")
	.attr("x", width)
	.attr("y", -6)
	.style("text-anchor", "end")
	.style("font", "24px sans-serif")
	.text("Crime Rate");

svg2.append("g")
	.attr("class", "y axis")
	.call(yAxis)
	.append("text")
	.attr("class", "label")
	.attr("transform", "rotate(-90)")
	.attr("y", 6)
	.attr("dy", ".71em")
	.style("text-anchor", "end")
	.style("font", "24px sans-serif")
	.text("Population")

svg2.selectAll(".dot")
	.data(data)
	.enter().append("circle")
	.attr("class", "dot")
	.attr("r", 3.5)
	.attr("cx", function(d) {
		return x(d.x);
	})
	.attr("cy", function(d) {
		return y(d.y);
	});

function create_data(nsamples) {
	var x = [];
	var y = [];
	var n = nsamples;
	var x_mean = 0;
	var y_mean = 0;
	var term1 = 0;
	var term2 = 0;
	var noise_factor = 100;
	var noise = 0;
	// create x and y values
	for (var i = 0; i < n; i++) {
		noise = noise_factor * Math.random();
		noise *= Math.round(Math.random()) == 1 ? 1 : -1;
		y.push(i / 5 + noise);
		x.push(i + 1);
		x_mean += x[i]
		y_mean += y[i]
	}
	// calculate mean x and y
	x_mean /= n;
	y_mean /= n;

	// calculate coefficients
	var xr = 0;
	var yr = 0;
	for (i = 0; i < x.length; i++) {
		xr = x[i] - x_mean;
		yr = y[i] - y_mean;
		term1 += xr * yr;
		term2 += xr * xr;

	}
	var b1 = term1 / term2;
	var b0 = y_mean - (b1 * x_mean);
	// perform regression 

	yhat = [];
	// fit line using coeffs
	for (i = 0; i < x.length; i++) {
		yhat.push(b0 + (x[i] * b1));
	}

	var data = [];
	for (i = 0; i < y.length; i++) {
		data.push({
			"yhat": yhat[i],
			"y": y[i],
			"x": x[i]
		})
	}
	return (data);
}

</script>
